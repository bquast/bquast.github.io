---
title: "Neural Network Instrumental Variables"
output: pdf_document
permalink: neural-network-instrumental-variables
tags:
- R
- linear model
- neural network
- machine learning
layout: post
published: false
---



{% highlight r %}
library(MASS)

# we are really generating x* and c and using a common variance
xStarAndC <- mvrnorm(1000, c(20, 15), matrix(c(1, 0.5, 0.5, 1), 2, 2))
xStar <- xStarAndC[, 1]
c <- xStarAndC[, 2]
z <- rnorm(1000)
x <- xStar + z

# using 1 makes it easy to estimate how 'wrong' an estimator is and toss
# some noise on y
y <- 1 + x + c + rnorm(1000, 0, 0.5)

lm(y ~ x + c)
{% endhighlight %}



{% highlight text %}
## 
## Call:
## lm(formula = y ~ x + c)
## 
## Coefficients:
## (Intercept)            x            c  
##      1.0651       0.9842       1.0166
{% endhighlight %}



{% highlight r %}
lm1    <- lm(x ~ z)
lmXhat <- lm1$fitted.values
lm2    <- lm(y ~ lmXhat)
lmYhat <- as.vector(lm2$fitted.values)
lmYhat
{% endhighlight %}



{% highlight text %}
##    [1] 33.96648 36.14197 37.54049 35.74887 37.21668 37.84562 38.15445
##    [8] 36.88224 36.01155 37.35468 36.89077 35.08913 35.67571 35.94591
##   [15] 35.67705 35.77641 36.24484 36.95818 36.93583 34.88244 34.86438
##   [22] 36.20968 36.62053 36.57241 34.19444 35.42756 36.05956 36.04119
##   [29] 36.35029 36.17434 35.64024 34.84273 37.89441 36.82092 35.71062
##   [36] 36.17437 35.46573 35.98863 36.25224 36.53140 35.18405 36.76593
##   [43] 35.44457 35.04701 35.69381 37.03388 36.20871 36.65011 37.91542
##   [50] 36.74454 36.27996 35.05396 35.98490 35.63171 36.73844 36.35290
##   [57] 34.68682 36.24377 35.34026 35.20880 37.26887 35.24945 35.14865
##   [64] 36.38695 34.90711 34.12175 36.47216 36.12733 33.45275 36.63506
##   [71] 35.60143 36.22367 37.28466 37.72304 36.06231 36.41691 35.79672
##   [78] 35.47353 34.90616 35.50231 35.01234 36.18373 36.43694 36.57740
##   [85] 36.59063 36.99311 36.33842 34.97238 34.52742 37.45951 35.59247
##   [92] 37.18056 34.39687 35.39197 36.94949 34.55927 35.90831 36.74060
##   [99] 35.09939 37.34171 36.10631 35.08785 37.19770 35.46353 35.92705
##  [106] 37.42874 34.27539 35.38795 34.38463 37.28981 36.25255 35.37777
##  [113] 36.25049 35.92557 35.72394 35.35982 37.00514 35.62326 36.24961
##  [120] 36.15289 37.38557 35.59322 36.48070 36.87198 36.33993 36.27521
##  [127] 36.55018 36.02594 35.76515 36.19225 36.09821 33.74203 37.42384
##  [134] 35.79022 36.38966 35.23538 36.89898 34.74620 36.03965 36.31450
##  [141] 37.17501 34.55620 36.11825 34.60527 34.72312 35.98584 36.08439
##  [148] 35.17669 36.24559 33.86832 35.85790 34.42968 34.06223 37.87664
##  [155] 35.42462 37.42202 36.62299 34.32511 35.01760 36.41371 36.29270
##  [162] 37.10180 35.58374 35.35278 35.87256 37.20060 37.68730 34.30408
##  [169] 35.87521 37.71319 35.58077 34.51576 35.00328 33.84838 36.58531
##  [176] 35.13911 36.33125 37.13384 36.61789 35.74648 35.94615 36.09357
##  [183] 36.42616 35.17789 36.74410 36.51204 36.70541 36.10399 37.41840
##  [190] 34.46496 32.32787 36.04644 34.66447 34.93244 34.61500 36.29273
##  [197] 36.08892 37.55268 37.05932 35.05783 34.23284 35.61150 34.85908
##  [204] 36.52095 35.98235 36.62918 38.22724 36.82555 36.48351 35.57067
##  [211] 34.91254 36.41816 36.07066 38.00031 38.33682 36.20163 35.04593
##  [218] 37.54445 35.79197 35.21492 36.82556 34.81256 36.62911 35.45813
##  [225] 37.08479 34.86728 35.91082 35.55570 35.17183 37.01531 36.04771
##  [232] 35.49186 37.02724 36.56302 35.66936 35.79843 35.37359 36.93322
##  [239] 35.35838 35.59751 36.74715 34.25752 35.30154 35.50540 36.57419
##  [246] 36.79495 36.87572 35.70592 35.55196 36.15481 37.03953 35.51769
##  [253] 36.48994 36.50105 35.74457 38.02861 36.33611 36.31169 34.94030
##  [260] 34.66650 37.28811 38.20561 36.57351 35.08787 35.34110 36.58554
##  [267] 36.50811 35.23109 33.96863 35.22048 35.56050 36.18061 36.27534
##  [274] 36.31835 36.37688 36.26619 36.53668 36.03058 36.07795 36.97640
##  [281] 34.02543 34.41864 35.41606 35.33816 35.85246 35.70224 33.74594
##  [288] 35.54737 36.00915 37.83183 35.30798 37.07277 35.73564 35.26770
##  [295] 35.70058 35.90970 34.59562 35.04389 35.39378 34.55988 36.04338
##  [302] 35.95615 36.08996 35.05929 35.27618 36.20381 36.80478 36.66686
##  [309] 37.13637 36.02663 36.24250 36.52336 37.13670 36.28220 36.69017
##  [316] 37.08167 35.40462 35.43384 35.81150 35.67569 36.37190 36.56123
##  [323] 35.87394 35.60934 36.87529 35.62256 36.35119 35.29347 35.06699
##  [330] 36.93095 36.24334 35.69781 35.73633 35.82458 37.63438 36.68390
##  [337] 36.41968 36.25865 36.21269 36.52515 35.79496 36.26794 36.63162
##  [344] 36.81249 37.23097 37.28079 35.37572 36.29381 36.20275 36.83082
##  [351] 37.49747 34.73293 36.52350 37.38956 34.38957 35.95711 35.83316
##  [358] 33.24869 37.71487 35.31175 36.78111 35.76003 36.72296 36.58917
##  [365] 35.77975 35.06032 37.38819 36.35204 36.17913 34.89457 37.12004
##  [372] 35.51381 35.98657 35.13585 34.83811 35.72784 35.33137 36.82269
##  [379] 38.04428 35.12169 35.80002 37.36304 37.60639 35.11113 34.72626
##  [386] 34.87427 36.07054 37.79937 37.27042 36.17623 34.61921 37.41979
##  [393] 35.98180 36.82025 35.85489 35.85444 34.80797 35.60363 36.22481
##  [400] 35.63731 35.70126 35.89409 36.00789 35.40968 35.99272 37.14490
##  [407] 36.63028 35.29545 36.10819 34.27360 35.57459 36.72434 37.36324
##  [414] 37.14826 35.48462 36.70399 34.92918 37.28152 36.49511 38.20284
##  [421] 35.49004 35.29778 36.12947 37.48276 35.18279 36.49253 37.54733
##  [428] 35.83022 37.38957 35.00502 36.07688 37.96922 35.63298 36.81165
##  [435] 37.80981 36.67069 34.22923 36.09395 38.27548 36.13319 36.54815
##  [442] 34.57916 37.51469 36.51916 37.38926 35.68892 36.78180 35.81112
##  [449] 36.38333 37.87103 36.53870 37.21252 35.47760 37.83999 37.38092
##  [456] 35.29276 35.42836 35.26987 35.26071 38.04888 35.28368 37.59116
##  [463] 35.90858 36.36129 34.95440 34.14009 34.74647 36.84824 35.09084
##  [470] 35.36075 35.43816 35.97949 35.39297 36.84659 35.60756 35.88771
##  [477] 34.64456 37.02253 35.05588 36.04027 36.57647 36.62427 37.88716
##  [484] 36.84285 35.30168 37.09483 36.81004 36.17838 35.70393 35.53314
##  [491] 36.08083 36.78439 36.79624 35.58144 36.33558 35.47264 37.18179
##  [498] 36.30540 34.84612 36.92646 35.96447 35.11361 35.63699 36.26859
##  [505] 32.64945 36.68835 35.11587 35.05056 35.96623 36.63809 36.44064
##  [512] 37.33141 34.99215 37.66863 34.43298 35.95838 37.05583 35.89348
##  [519] 36.67286 36.06187 36.40362 35.87413 35.98910 35.96790 37.13423
##  [526] 36.65912 36.63626 35.04468 35.49551 36.10090 35.97316 34.93497
##  [533] 35.94721 35.40906 36.08632 35.65629 36.44045 34.52975 36.90068
##  [540] 35.57609 35.86852 36.33669 36.69664 35.58286 35.74624 36.75503
##  [547] 36.59137 36.42023 36.07061 36.74215 34.86029 35.50631 37.14658
##  [554] 36.63031 37.02035 37.07983 35.57676 35.25900 35.77022 37.97493
##  [561] 34.93453 36.69146 37.25660 35.89985 35.95617 37.71704 35.25058
##  [568] 35.46118 36.94370 36.62916 36.37153 35.02790 35.02395 35.02287
##  [575] 36.67939 35.04857 35.17679 36.92151 37.37795 37.08026 37.94592
##  [582] 36.04277 36.92413 37.70820 36.70479 37.10172 37.14014 35.37612
##  [589] 35.83720 35.95193 37.74698 35.78589 36.39617 36.61800 34.33625
##  [596] 35.34323 35.37949 36.81507 35.49252 34.46300 34.98941 37.27495
##  [603] 35.12411 37.51085 35.28435 36.79153 37.04679 35.48969 35.75303
##  [610] 35.14290 36.79382 35.43227 36.68929 34.45375 35.74065 35.06616
##  [617] 34.64543 37.38176 36.26685 36.06298 36.89828 36.62368 37.23639
##  [624] 36.56070 35.53428 36.77002 35.95850 36.87733 35.90716 34.59057
##  [631] 36.43492 36.04800 35.87714 36.07493 37.21162 35.20260 36.88266
##  [638] 37.92880 36.01150 36.62989 35.99420 34.90961 36.05380 37.51632
##  [645] 35.82461 34.93289 37.78328 36.83317 36.38779 35.00189 34.95967
##  [652] 35.09769 37.37418 38.61496 36.60865 36.22731 35.11043 38.36399
##  [659] 35.38345 36.33352 36.77600 36.80396 36.83413 38.56300 37.05980
##  [666] 34.04218 34.37834 35.37374 34.91799 36.18825 35.76739 36.13874
##  [673] 37.33370 36.66935 36.03785 35.66038 36.03480 36.16487 36.32442
##  [680] 34.76807 35.45625 36.96911 34.69283 35.72665 36.26974 36.38331
##  [687] 36.03108 37.23990 35.05562 35.33218 35.57833 34.79922 35.35488
##  [694] 37.01231 35.06199 34.57024 36.54212 35.43556 35.77136 35.38313
##  [701] 36.65526 35.71060 36.23034 35.57639 37.91327 34.58908 36.31417
##  [708] 36.95738 35.15860 36.85811 37.71290 38.49568 36.22784 34.21312
##  [715] 36.94868 36.67173 36.45549 35.92477 34.96399 36.08726 38.28338
##  [722] 35.28809 36.05119 34.32982 35.53281 36.71592 35.82031 33.99161
##  [729] 35.63945 36.69002 35.34999 34.87187 35.33951 36.72250 37.73192
##  [736] 37.22213 35.71912 35.00863 36.77713 34.72083 34.92058 34.71229
##  [743] 35.92581 34.73608 34.74209 36.02264 37.23300 36.54344 37.27109
##  [750] 36.30084 38.36032 36.66142 36.04251 36.25215 36.15284 34.80130
##  [757] 36.67743 35.95648 36.25094 37.03642 36.69252 36.55393 35.60643
##  [764] 35.68590 35.40305 35.84649 36.78694 35.58248 36.84250 36.50897
##  [771] 36.81316 36.37445 35.35112 35.84289 37.20361 34.80495 35.86157
##  [778] 34.56370 35.60112 35.72524 38.09682 36.26108 34.73120 35.73788
##  [785] 37.73251 35.42453 35.94275 36.08085 35.71116 37.12340 33.66332
##  [792] 36.59301 35.28048 35.82404 34.26157 35.76057 36.79247 35.29753
##  [799] 36.47430 35.70882 36.62783 35.83341 36.54452 34.74792 37.40525
##  [806] 33.18652 34.42112 35.95225 36.12813 37.65241 34.72198 35.15253
##  [813] 35.80432 34.90684 36.06336 36.32118 37.53004 36.04256 36.45892
##  [820] 35.49603 34.84101 36.10429 36.05655 35.80199 36.80725 34.83929
##  [827] 36.45643 36.76546 36.32698 35.41699 37.47891 36.31858 35.98465
##  [834] 35.96688 36.72513 36.28331 34.26703 35.12216 37.34043 36.60156
##  [841] 36.21982 35.33163 34.83321 34.94929 35.58805 35.59229 35.18940
##  [848] 35.01980 36.96028 37.04412 34.53479 37.27436 37.14603 34.89329
##  [855] 34.85788 35.63580 34.66533 38.47792 36.47388 36.27742 35.40094
##  [862] 36.82748 35.99368 38.25684 36.33886 35.16394 36.03667 36.79327
##  [869] 37.47575 36.77028 36.26153 34.27465 35.50694 34.07652 35.65098
##  [876] 36.99984 36.33341 35.25316 34.74624 37.63401 35.36579 34.49880
##  [883] 36.27261 35.09743 35.95268 37.58663 35.74815 35.44902 36.22739
##  [890] 36.00187 36.10386 34.77530 35.93448 35.68483 37.62303 34.33581
##  [897] 34.52316 35.75704 36.29828 36.01612 37.42100 34.86661 37.17243
##  [904] 36.15932 36.33235 35.46992 35.54712 37.38435 36.59917 36.06620
##  [911] 36.48473 36.55873 37.10573 36.35153 37.14447 34.99255 37.10907
##  [918] 36.43763 35.25653 37.49257 35.02676 36.72024 36.71336 36.61670
##  [925] 37.14028 35.21301 37.15809 35.86307 37.16799 35.97879 36.76284
##  [932] 37.19413 35.20566 35.45022 35.70399 36.52490 35.76584 35.89461
##  [939] 37.13895 36.24244 35.74613 35.87676 37.13912 35.78362 37.81436
##  [946] 35.74807 34.67105 36.13666 36.40677 36.86459 35.41434 35.41973
##  [953] 36.51554 35.71132 35.27925 35.32520 36.16238 36.85207 35.89258
##  [960] 34.71427 36.37397 35.70797 35.95500 36.36032 36.85201 36.86108
##  [967] 35.47292 34.45501 35.92595 37.43191 35.36045 34.54777 36.22272
##  [974] 36.51954 37.19032 37.82134 35.73128 36.18574 37.08255 35.86318
##  [981] 35.81560 37.20603 36.61610 36.22524 35.58171 34.91829 35.48104
##  [988] 35.39337 35.13951 35.24466 35.64071 36.91371 35.91315 36.78678
##  [995] 35.63538 36.88526 34.72841 35.69856 34.82047 35.29180
{% endhighlight %}



{% highlight r %}
## now using nnet

# load and train
library(nnet)
nn1    <- nnet(x ~ z, size=0, skip=TRUE, linout=TRUE )
{% endhighlight %}



{% highlight text %}
## # weights:  2
## initial  value 419421.467679 
## final  value 1005.785933 
## converged
{% endhighlight %}



{% highlight r %}
# obtain fitted values
nnXhat <- predict(nn1, z)

# instrument
nn2    <- nnet(y ~ nnXhat, size=0, skip=TRUE, linout=TRUE )
{% endhighlight %}



{% highlight text %}
## # weights:  2
## initial  value 965848.463260 
## final  value 3257.303144 
## converged
{% endhighlight %}



{% highlight r %}
nnYhat <- as.vector(predict(nn2, nnXhat))
nnYhat
{% endhighlight %}



{% highlight text %}
##    [1] 33.96647 36.14197 37.54049 35.74887 37.21668 37.84562 38.15445
##    [8] 36.88224 36.01156 37.35468 36.89077 35.08913 35.67571 35.94591
##   [15] 35.67705 35.77641 36.24484 36.95818 36.93583 34.88244 34.86437
##   [22] 36.20968 36.62053 36.57241 34.19443 35.42756 36.05956 36.04119
##   [29] 36.35029 36.17434 35.64024 34.84272 37.89441 36.82092 35.71062
##   [36] 36.17437 35.46573 35.98863 36.25224 36.53140 35.18404 36.76593
##   [43] 35.44457 35.04701 35.69381 37.03388 36.20871 36.65011 37.91542
##   [50] 36.74454 36.27996 35.05396 35.98490 35.63171 36.73845 36.35290
##   [57] 34.68681 36.24378 35.34026 35.20880 37.26887 35.24945 35.14865
##   [64] 36.38695 34.90710 34.12175 36.47216 36.12733 33.45275 36.63507
##   [71] 35.60143 36.22367 37.28466 37.72304 36.06232 36.41691 35.79672
##   [78] 35.47353 34.90616 35.50230 35.01234 36.18373 36.43694 36.57740
##   [85] 36.59064 36.99311 36.33843 34.97237 34.52742 37.45951 35.59247
##   [92] 37.18056 34.39686 35.39197 36.94949 34.55927 35.90831 36.74060
##   [99] 35.09939 37.34171 36.10631 35.08784 37.19770 35.46353 35.92705
##  [106] 37.42874 34.27538 35.38795 34.38463 37.28981 36.25255 35.37777
##  [113] 36.25049 35.92557 35.72394 35.35982 37.00514 35.62326 36.24961
##  [120] 36.15289 37.38557 35.59322 36.48070 36.87199 36.33994 36.27521
##  [127] 36.55018 36.02594 35.76515 36.19225 36.09821 33.74202 37.42384
##  [134] 35.79022 36.38966 35.23538 36.89898 34.74620 36.03965 36.31450
##  [141] 37.17501 34.55620 36.11825 34.60527 34.72312 35.98584 36.08439
##  [148] 35.17669 36.24559 33.86831 35.85790 34.42967 34.06222 37.87665
##  [155] 35.42462 37.42202 36.62300 34.32511 35.01760 36.41371 36.29270
##  [162] 37.10181 35.58374 35.35278 35.87256 37.20060 37.68730 34.30408
##  [169] 35.87521 37.71319 35.58077 34.51576 35.00327 33.84837 36.58532
##  [176] 35.13911 36.33125 37.13384 36.61789 35.74648 35.94615 36.09357
##  [183] 36.42617 35.17788 36.74410 36.51204 36.70541 36.10399 37.41841
##  [190] 34.46496 32.32786 36.04644 34.66447 34.93244 34.61500 36.29273
##  [197] 36.08892 37.55269 37.05932 35.05783 34.23283 35.61150 34.85908
##  [204] 36.52095 35.98235 36.62918 38.22725 36.82556 36.48351 35.57066
##  [211] 34.91254 36.41816 36.07066 38.00031 38.33682 36.20164 35.04593
##  [218] 37.54446 35.79197 35.21492 36.82556 34.81256 36.62912 35.45813
##  [225] 37.08479 34.86728 35.91082 35.55570 35.17183 37.01531 36.04771
##  [232] 35.49186 37.02725 36.56302 35.66936 35.79843 35.37359 36.93322
##  [239] 35.35838 35.59751 36.74715 34.25752 35.30154 35.50540 36.57419
##  [246] 36.79496 36.87573 35.70592 35.55196 36.15481 37.03954 35.51769
##  [253] 36.48994 36.50105 35.74457 38.02861 36.33611 36.31169 34.94030
##  [260] 34.66650 37.28812 38.20561 36.57351 35.08787 35.34110 36.58555
##  [267] 36.50811 35.23109 33.96862 35.22048 35.56050 36.18061 36.27534
##  [274] 36.31835 36.37688 36.26619 36.53669 36.03058 36.07795 36.97640
##  [281] 34.02542 34.41864 35.41606 35.33816 35.85246 35.70224 33.74593
##  [288] 35.54737 36.00915 37.83184 35.30798 37.07277 35.73564 35.26770
##  [295] 35.70058 35.90970 34.59562 35.04389 35.39378 34.55988 36.04338
##  [302] 35.95615 36.08996 35.05929 35.27618 36.20381 36.80478 36.66686
##  [309] 37.13638 36.02663 36.24250 36.52336 37.13671 36.28220 36.69018
##  [316] 37.08167 35.40462 35.43384 35.81150 35.67569 36.37190 36.56123
##  [323] 35.87394 35.60934 36.87529 35.62256 36.35119 35.29347 35.06699
##  [330] 36.93095 36.24334 35.69781 35.73633 35.82458 37.63439 36.68391
##  [337] 36.41968 36.25865 36.21269 36.52516 35.79496 36.26794 36.63162
##  [344] 36.81249 37.23097 37.28080 35.37572 36.29381 36.20275 36.83082
##  [351] 37.49747 34.73293 36.52350 37.38956 34.38957 35.95711 35.83316
##  [358] 33.24868 37.71488 35.31175 36.78112 35.76003 36.72297 36.58918
##  [365] 35.77975 35.06031 37.38819 36.35204 36.17913 34.89457 37.12004
##  [372] 35.51381 35.98657 35.13584 34.83811 35.72784 35.33137 36.82269
##  [379] 38.04429 35.12169 35.80002 37.36304 37.60639 35.11113 34.72626
##  [386] 34.87426 36.07054 37.79937 37.27042 36.17623 34.61921 37.41979
##  [393] 35.98180 36.82025 35.85489 35.85444 34.80797 35.60363 36.22481
##  [400] 35.63731 35.70126 35.89409 36.00789 35.40968 35.99272 37.14490
##  [407] 36.63028 35.29544 36.10819 34.27360 35.57458 36.72434 37.36324
##  [414] 37.14826 35.48462 36.70399 34.92918 37.28152 36.49512 38.20285
##  [421] 35.49003 35.29778 36.12947 37.48276 35.18279 36.49253 37.54734
##  [428] 35.83022 37.38957 35.00502 36.07688 37.96922 35.63298 36.81165
##  [435] 37.80981 36.67070 34.22923 36.09395 38.27549 36.13319 36.54816
##  [442] 34.57916 37.51470 36.51917 37.38926 35.68892 36.78180 35.81112
##  [449] 36.38333 37.87103 36.53870 37.21252 35.47760 37.83999 37.38092
##  [456] 35.29276 35.42836 35.26987 35.26071 38.04888 35.28368 37.59116
##  [463] 35.90858 36.36130 34.95440 34.14009 34.74647 36.84824 35.09084
##  [470] 35.36075 35.43816 35.97949 35.39297 36.84659 35.60756 35.88772
##  [477] 34.64456 37.02254 35.05588 36.04027 36.57647 36.62427 37.88716
##  [484] 36.84286 35.30168 37.09484 36.81005 36.17838 35.70393 35.53314
##  [491] 36.08083 36.78440 36.79625 35.58143 36.33558 35.47263 37.18179
##  [498] 36.30540 34.84612 36.92646 35.96447 35.11361 35.63699 36.26859
##  [505] 32.64944 36.68835 35.11586 35.05056 35.96623 36.63809 36.44064
##  [512] 37.33141 34.99215 37.66863 34.43298 35.95838 37.05583 35.89348
##  [519] 36.67286 36.06187 36.40362 35.87413 35.98910 35.96790 37.13424
##  [526] 36.65912 36.63626 35.04468 35.49551 36.10090 35.97316 34.93497
##  [533] 35.94721 35.40906 36.08632 35.65629 36.44045 34.52975 36.90068
##  [540] 35.57609 35.86852 36.33670 36.69664 35.58286 35.74624 36.75503
##  [547] 36.59137 36.42023 36.07061 36.74215 34.86028 35.50631 37.14658
##  [554] 36.63031 37.02035 37.07983 35.57676 35.25900 35.77022 37.97494
##  [561] 34.93453 36.69146 37.25661 35.89985 35.95617 37.71705 35.25058
##  [568] 35.46118 36.94371 36.62916 36.37153 35.02790 35.02394 35.02287
##  [575] 36.67939 35.04857 35.17678 36.92151 37.37795 37.08026 37.94593
##  [582] 36.04277 36.92414 37.70821 36.70479 37.10173 37.14014 35.37612
##  [589] 35.83720 35.95193 37.74698 35.78589 36.39617 36.61801 34.33625
##  [596] 35.34323 35.37949 36.81507 35.49251 34.46299 34.98940 37.27495
##  [603] 35.12411 37.51086 35.28435 36.79153 37.04679 35.48969 35.75303
##  [610] 35.14290 36.79382 35.43227 36.68929 34.45375 35.74065 35.06616
##  [617] 34.64543 37.38177 36.26685 36.06298 36.89828 36.62369 37.23639
##  [624] 36.56070 35.53428 36.77002 35.95850 36.87733 35.90716 34.59056
##  [631] 36.43492 36.04800 35.87714 36.07493 37.21162 35.20260 36.88267
##  [638] 37.92880 36.01150 36.62989 35.99420 34.90960 36.05380 37.51633
##  [645] 35.82461 34.93289 37.78328 36.83317 36.38780 35.00189 34.95967
##  [652] 35.09769 37.37418 38.61496 36.60865 36.22731 35.11043 38.36399
##  [659] 35.38345 36.33352 36.77600 36.80397 36.83413 38.56301 37.05980
##  [666] 34.04218 34.37833 35.37374 34.91799 36.18825 35.76739 36.13874
##  [673] 37.33371 36.66935 36.03785 35.66038 36.03480 36.16487 36.32442
##  [680] 34.76807 35.45625 36.96911 34.69282 35.72665 36.26974 36.38332
##  [687] 36.03108 37.23990 35.05562 35.33218 35.57833 34.79921 35.35488
##  [694] 37.01231 35.06199 34.57024 36.54212 35.43555 35.77136 35.38313
##  [701] 36.65527 35.71060 36.23034 35.57639 37.91327 34.58908 36.31417
##  [708] 36.95738 35.15860 36.85811 37.71290 38.49568 36.22784 34.21312
##  [715] 36.94868 36.67173 36.45549 35.92477 34.96399 36.08726 38.28339
##  [722] 35.28809 36.05119 34.32982 35.53281 36.71593 35.82031 33.99161
##  [729] 35.63945 36.69002 35.34999 34.87187 35.33951 36.72250 37.73193
##  [736] 37.22213 35.71912 35.00863 36.77713 34.72083 34.92058 34.71229
##  [743] 35.92581 34.73608 34.74209 36.02265 37.23300 36.54344 37.27109
##  [750] 36.30085 38.36033 36.66142 36.04251 36.25215 36.15285 34.80130
##  [757] 36.67743 35.95648 36.25094 37.03642 36.69252 36.55393 35.60642
##  [764] 35.68590 35.40305 35.84649 36.78694 35.58248 36.84251 36.50898
##  [771] 36.81316 36.37445 35.35112 35.84289 37.20361 34.80495 35.86157
##  [778] 34.56370 35.60112 35.72524 38.09682 36.26108 34.73120 35.73788
##  [785] 37.73252 35.42453 35.94275 36.08085 35.71116 37.12340 33.66332
##  [792] 36.59301 35.28048 35.82404 34.26156 35.76057 36.79247 35.29753
##  [799] 36.47430 35.70882 36.62783 35.83341 36.54452 34.74792 37.40525
##  [806] 33.18651 34.42112 35.95225 36.12813 37.65241 34.72198 35.15253
##  [813] 35.80432 34.90683 36.06337 36.32118 37.53004 36.04256 36.45893
##  [820] 35.49603 34.84101 36.10429 36.05656 35.80199 36.80726 34.83929
##  [827] 36.45643 36.76547 36.32698 35.41699 37.47891 36.31859 35.98465
##  [834] 35.96688 36.72513 36.28331 34.26703 35.12216 37.34043 36.60156
##  [841] 36.21982 35.33163 34.83321 34.94929 35.58805 35.59229 35.18940
##  [848] 35.01980 36.96028 37.04412 34.53479 37.27436 37.14603 34.89329
##  [855] 34.85788 35.63580 34.66532 38.47792 36.47388 36.27742 35.40094
##  [862] 36.82748 35.99368 38.25685 36.33886 35.16394 36.03667 36.79327
##  [869] 37.47575 36.77028 36.26153 34.27465 35.50694 34.07651 35.65098
##  [876] 36.99984 36.33341 35.25316 34.74624 37.63401 35.36579 34.49880
##  [883] 36.27261 35.09743 35.95268 37.58664 35.74815 35.44901 36.22739
##  [890] 36.00187 36.10386 34.77530 35.93448 35.68483 37.62304 34.33581
##  [897] 34.52316 35.75704 36.29829 36.01612 37.42101 34.86661 37.17243
##  [904] 36.15932 36.33235 35.46992 35.54712 37.38436 36.59917 36.06620
##  [911] 36.48473 36.55873 37.10573 36.35153 37.14448 34.99255 37.10907
##  [918] 36.43763 35.25653 37.49257 35.02675 36.72025 36.71336 36.61670
##  [925] 37.14029 35.21301 37.15809 35.86307 37.16799 35.97879 36.76284
##  [932] 37.19413 35.20566 35.45022 35.70399 36.52490 35.76584 35.89461
##  [939] 37.13896 36.24244 35.74613 35.87676 37.13912 35.78362 37.81436
##  [946] 35.74807 34.67105 36.13666 36.40677 36.86459 35.41434 35.41973
##  [953] 36.51554 35.71132 35.27925 35.32520 36.16238 36.85208 35.89258
##  [960] 34.71427 36.37397 35.70797 35.95500 36.36032 36.85201 36.86108
##  [967] 35.47292 34.45501 35.92595 37.43192 35.36045 34.54777 36.22272
##  [974] 36.51954 37.19032 37.82135 35.73128 36.18574 37.08255 35.86318
##  [981] 35.81560 37.20603 36.61611 36.22524 35.58171 34.91829 35.48104
##  [988] 35.39337 35.13951 35.24466 35.64071 36.91371 35.91315 36.78678
##  [995] 35.63538 36.88526 34.72841 35.69856 34.82047 35.29180
{% endhighlight %}

In this short post I want to quickly demonstrate how the most basic neural network (no hidden layer) gives us the same results as the linear model.

First we need data


{% highlight r %}
data(swiss)
str(swiss)
{% endhighlight %}



{% highlight text %}
## 'data.frame':	47 obs. of  6 variables:
##  $ Fertility       : num  80.2 83.1 92.5 85.8 76.9 76.1 83.8 92.4 82.4 82.9 ...
##  $ Agriculture     : num  17 45.1 39.7 36.5 43.5 35.3 70.2 67.8 53.3 45.2 ...
##  $ Examination     : int  15 6 5 12 17 9 16 14 12 16 ...
##  $ Education       : int  12 9 5 7 15 7 7 8 7 13 ...
##  $ Catholic        : num  9.96 84.84 93.4 33.77 5.16 ...
##  $ Infant.Mortality: num  22.2 22.2 20.2 20.3 20.6 26.6 23.6 24.9 21 24.4 ...
{% endhighlight %}

We can now specify a model.


{% highlight r %}
m1 <- formula(Fertility ~ Agriculture + Examination + Education + Catholic + Infant.Mortality)
{% endhighlight %}

Let's start by estimating a linear model.


{% highlight r %}
lm1 <- lm(formula=m1, data=swiss)
summary(lm1)
{% endhighlight %}



{% highlight text %}
## 
## Call:
## lm(formula = m1, data = swiss)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.2743  -5.2617   0.5032   4.1198  15.3213 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(>|t|)    
## (Intercept)      66.91518   10.70604   6.250 1.91e-07 ***
## Agriculture      -0.17211    0.07030  -2.448  0.01873 *  
## Examination      -0.25801    0.25388  -1.016  0.31546    
## Education        -0.87094    0.18303  -4.758 2.43e-05 ***
## Catholic          0.10412    0.03526   2.953  0.00519 ** 
## Infant.Mortality  1.07705    0.38172   2.822  0.00734 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 7.165 on 41 degrees of freedom
## Multiple R-squared:  0.7067,	Adjusted R-squared:  0.671 
## F-statistic: 19.76 on 5 and 41 DF,  p-value: 5.594e-10
{% endhighlight %}

Now lets use the built in `nnet` package to estimate a neural network without a hidden layer.


{% highlight r %}
library(nnet)
nn1 <- nnet(formula=m1, data=swiss, size=0, skip=TRUE, linout=TRUE)
{% endhighlight %}



{% highlight text %}
## # weights:  6
## initial  value 62996.029496 
## final  value 2105.042930 
## converged
{% endhighlight %}



{% highlight r %}
summary(nn1)
{% endhighlight %}



{% highlight text %}
## a 5-0-1 network with 6 weights
## options were - skip-layer connections  linear output units 
##  b->o i1->o i2->o i3->o i4->o i5->o 
## 66.92 -0.17 -0.26 -0.87  0.10  1.08
{% endhighlight %}

Let look at the results next to each other.


{% highlight r %}
lm1
summary(nn1)
{% endhighlight %}



{% highlight text %}
## 
## Call:
## lm(formula = m1, data = swiss)
## 
## Coefficients:
##      (Intercept)       Agriculture       Examination  
##          66.9152           -0.1721           -0.2580  
##        Education          Catholic  Infant.Mortality  
##          -0.8709            0.1041            1.0770  
## 
## a 5-0-1 network with 6 weights
## options were - skip-layer connections  linear output units 
##  b->o i1->o i2->o i3->o i4->o i5->o 
## 66.92 -0.17 -0.26 -0.87  0.10  1.08
{% endhighlight %}

We can also estimate this model using the `neuralnet` package (this package needs to be installed first using `install.packages("neuralnet")`). This package allows us to nicely visualise the results.


{% highlight r %}
library(neuralnet)
{% endhighlight %}



{% highlight text %}
## Loading required package: grid
{% endhighlight %}



{% highlight r %}
nn1a <- neuralnet(formula=m1, data=swiss, hidden=0, linear.output=TRUE)
plot(nn1a, rep='best')
{% endhighlight %}

![plot of chunk neuralnet](/images/source/2015-10-20-neural-network-instrumental-variables/neuralnet-1.png) 

Of course it only becomes interesting if we include a hidden layer.


{% highlight r %}
nn2a <- neuralnet(formula=m1, data=swiss, hidden=2)
plot(nn2a, rep='best')
{% endhighlight %}

![plot of chunk hidden](/images/source/2015-10-20-neural-network-instrumental-variables/hidden-1.png) 
